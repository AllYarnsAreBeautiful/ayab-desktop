<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ayab-desktop: AYAB - All Yarns Are Beautiful</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ayab_logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ayab-desktop
   </div>
   <div id="projectbrief">AYAB desktop software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AYAB - All Yarns Are Beautiful </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Linux</p>
<p>This is the GUI interface for AYAB.</p>
<p>For information on how to install the release version of the software, see <a href="http://manual.ayab-knitting.com">http://manual.ayab-knitting.com</a></p>
<h1><a class="anchor" id="autotoc_md30"></a>
Running from Source &amp; Development</h1>
<p>The AYAB desktop software runs using Python 3.11. <br  />
 The Python module dependencies are split across <b>runtime dependencies</b>, which are in <em>requirements.build.txt</em> and <b>development dependencies</b>, found in <em>requirements.txt</em>.</p>
<p>This repository uses <a href="https://pre-commit.com/">pre-commit</a> hooks. After cloning the repo and installing the development dependencies, you should run <code>pre-commit install</code> to set up the git hook scripts. </p>
<h2><a class="anchor" id="autotoc_md31"></a>
Platform-Specific Setup</h2>
<p>&lt;details&gt;</p>
<p>For flashing the firmware, avrdude has to be available on your system. <br  />
 To be able to work on GUI elements and translation files, you will also need Qt Dev &amp; Localization Tools. </p>
<h3><a class="anchor" id="autotoc_md32"></a>
Debian/Ubuntu</h3>
<div class="fragment"><div class="line">sudo apt install python3.11 python3.11-dev python3.11-venv</div>
<div class="line">sudo apt install libasound2-dev avrdude qt6-tools-dev-tools build-essential qt6-l10n-tools</div>
<div class="line">export PATH=/usr/lib/qt6/bin:$PATH</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md33"></a>
openSUSE</h3>
<div class="fragment"><div class="line">sudo zypper install python311 python311-pip python311-virtualenv python311-devel</div>
<div class="line">sudo zypper install libasound2 alsa-devel avrdude qt6-tools qt6-tools-linguist</div>
<div class="line">export PATH=/usr/lib/qt6/bin:$PATH </div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md34"></a>
All Distributions</h3>
<p>To be able to communicate with your Arduino, it might be necessary to add the rights for USB communication by adding your user to some groups. </p><div class="fragment"><div class="line">sudo usermod -aG tty [userName]</div>
<div class="line">sudo usermod -aG dialout [userName]</div>
</div><!-- fragment --><p> &lt;/details&gt;</p>
<p>&lt;details&gt;</p>
<p>Windows</p>
<p>AYAB requires Windows version 10 or later.</p>
<p>Run Anaconda Powershell as administrator and install git. </p><div class="fragment"><div class="line">conda install git</div>
</div><!-- fragment --><p> Now you can download the git repository with: </p><div class="fragment"><div class="line">git clone https://github.com/AllYarnsAreBeautiful/ayab-desktop</div>
<div class="line">cd ayab-desktop</div>
</div><!-- fragment --><p> Next, create a virtual environment for AYAB: </p><div class="fragment"><div class="line">conda create --name ayab -c conda-forge python=3.11 pip</div>
</div><!-- fragment --><p> Activate the virtual environment. The command prompt should now display <code>(ayab)</code> at the beginning of each line. </p><div class="fragment"><div class="line">conda activate ayab</div>
</div><!-- fragment --><p> (You may skip the virtual environment setup below.)</p>
<p>To be able to work on GUI elements and translation files, the Qt Dev tools are needed. <br  />
 Navigate to <a href="https://www.qt.io/download-open-source">https://www.qt.io/download-open-source</a> in a web browser and follow the installation instructions. From the available options, select "Custom install" and then "Qt 6.6.3". You will also need to download and install Perl from <a href="https://www.perl.org/get.html">https://www.perl.org/get.html</a>. &lt;/details&gt;</p>
<p>&lt;details&gt;</p>
<p>macOS</p>
<p>You can install Git using Homebrew: </p><div class="fragment"><div class="line">brew install git</div>
</div><!-- fragment --><p> You will also need the Xcode command line tools: </p><div class="fragment"><div class="line">xcode-select --install</div>
</div><!-- fragment --><p> To be able to work on GUI elements and translation files, the Qt Dev tools are needed also: </p><div class="fragment"><div class="line">brew install qt</div>
</div><!-- fragment --><p> Install python from <a href="https://www.python.org/ftp/python/3.11.8/python-3.11.8-macos11.pkg">the official universal2 installer</a>. (Conda does not produce universal binaries) <br  />
</p>
<p>If you encounter the pip <code>SSL:TLSV1_ALERT_PROTOCOL_VERSION</code> problem: </p><div class="fragment"><div class="line">curl https://bootstrap.pypa.io/get-pip.py | python</div>
</div><!-- fragment --><p> &lt;/details&gt;</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Universal Setup Steps</h2>
<p>Once platform-specific setup is complete, download the git repository: </p><div class="fragment"><div class="line">git clone https://github.com/AllYarnsAreBeautiful/ayab-desktop</div>
<div class="line">cd ayab-desktop</div>
</div><!-- fragment --><p> Create a virtual environment for AYAB: </p><div class="fragment"><div class="line">python3.11 -m venv .venv </div>
</div><!-- fragment --><p> Now activate the virtual environment. The command prompt should now display <code>(.venv)</code> at the beginning of each line. </p><div class="fragment"><div class="line">source .venv/bin/activate</div>
</div><!-- fragment --><p> Install the remaining prerequisites with: </p><div class="fragment"><div class="line">python -m pip install --upgrade pip</div>
<div class="line">pip install --upgrade setuptools</div>
<div class="line">pip install -r requirements.txt</div>
</div><!-- fragment --><p>Next, convert the PySide6 <code>.ui</code> files and generate the translation files: </p><div class="fragment"><div class="line">bash ./setup-environment.ps1</div>
</div><!-- fragment --><p> If you get errors about missing <code>lrelease</code>, you can skip this (if you do not need the translation files). To do so, comment out lines [23:26] of <code>setup-environment.ps1</code>.</p>
<p>Finally, you can start AYAB with </p><div class="fragment"><div class="line">fbs run</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md36"></a>
CI/CD on GitHub</h1>
<h2><a class="anchor" id="autotoc_md37"></a>
Triggering a new build</h2>
<p>A new build is triggered when a new tag is created, either starting with</p>
<ul>
<li>v (i.e. v1.0.0), or</li>
<li>test (i.e. test230517)</li>
</ul>
<p>Convention for the test-tag is to suffix the current date in the YYMMdd format. If there is already an existing test build for a single day, attach a letter. The test tags and releases will be manually removed from time for a better overview.</p>
<p>The tag can be pushed from your local environment, or via the <a href="https://github.com/AllYarnsAreBeautiful/ayab-desktop/releases/new">"Draft a new Release"</a> button on the GitHub website.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
Choosing the firmware release to be bundled with the build</h2>
<p>The CI automatically downloads a given firmware release from the <a href="https://github.com/AllYarnsAreBeautiful/ayab-firmware">ayab-firmware repo</a> and packs it into the Desktop release. The name of the firmware release is chosen in <a href="https://github.com/AllYarnsAreBeautiful/ayab-desktop/blob/1.0.0-dev/src/main/resources/base/ayab/firmware/manifest.txt">this manifest file</a> in the ayab-desktop repo.</p>
<p>Whenever building from source, you should ensure that the firmware is available as a compiled hex file is available at <code>main/resources/base/ayab/firmware/firmware.hex</code>. You can either compile the firmware and upload it through other means (e.g. VSCode with PlatformIO), or compile and then drop it into the right path in the desktop directory, making it available for the flash through AYAB desktop. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
